<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Quiz de √äxodo ‚Äî Velho Testamento</title>
<style>
:root{
  --bg:#040405; --panel:#0b0b0c; --gold:#D4AF37; --bronze:#b8860b; --text:#efe6c8;
}
html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial;background:linear-gradient(180deg,#000 0%, #071018 60%);color:var(--text);}
.container{max-width:980px;margin:20px auto;padding:18px;}
.card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border-radius:14px;padding:16px;border:1px solid rgba(255,255,255,0.02);box-shadow:0 12px 40px rgba(0,0,0,0.6);}
.header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}
.header h1{margin:0;font-size:18px;color:var(--gold)}
.header .meta{font-size:13px;color:rgba(212,175,55,0.9)}
.layout{display:grid;grid-template-columns:1fr 340px;gap:16px}
@media(max-width:880px){ .layout{grid-template-columns:1fr} }
.panel{padding:14px;border-radius:12px;background:linear-gradient(180deg,rgba(255,255,255,0.01), rgba(255,255,255,0.00));border:1px solid rgba(255,255,255,0.02) }
.logo{width:72px;height:72px;border-radius:12px;background:linear-gradient(135deg,#0b0b0c,#111);display:flex;align-items:center;justify-content:center;font-weight:800;color:var(--gold);font-size:16px}
input[type=text]{width:100%;padding:12px;border-radius:10px;border:1px solid rgba(212,175,55,0.12);background:transparent;color:var(--text);font-size:15px}
.btn{display:inline-block;padding:12px 16px;border-radius:12px;border:none;font-weight:700;cursor:pointer}
.btn.primary{background:linear-gradient(90deg,#2b2b2b,#111);color:var(--bronze);border:1px solid rgba(212,175,55,0.18);box-shadow:0 8px 30px rgba(0,0,0,0.6)}
.btn.ghost{background:transparent;color:var(--text);border:1px solid rgba(255,255,255,0.04)}
.small{font-size:13px;color:rgba(255,255,255,0.7)}
.qscreen{display:none;animation:appear .26s ease both}
.active{display:block}
@keyframes appear{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}
.q-meta{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;color:#cdbb82}
.q-text{font-size:18px;font-weight:700;margin-bottom:12px;color:var(--text)}
.choices{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.choice{
  background: linear-gradient(180deg, #161616, #232323);
  padding:14px;border-radius:10px;border:1px solid rgba(212,175,55,0.22);
  color:#fff;cursor:pointer;text-align:left;font-weight:800;min-height:52px;font-size:15px;
  transition: transform .12s ease, box-shadow .12s ease, background .12s;
}
.choice:hover{transform:translateY(-6px);box-shadow:0 18px 40px rgba(0,0,0,0.6);background:linear-gradient(180deg,#232323,#2b2b2b)}
.failure-banner{position:fixed;left:50%;transform:translateX(-50%);top:18px;padding:10px 16px;border-radius:10px;background:linear-gradient(90deg,#7b1530,#b22a4a);color:white;font-weight:800;display:none;z-index:999}
.stat{display:flex;justify-content:space-between;align-items:center;padding:12px;border-radius:10px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);border:1px solid rgba(255,255,255,0.02)}
.leader{max-height:280px;overflow:auto;margin-top:8px}
.tiny{font-size:12px;color:rgba(255,255,255,0.6)}
.impossible{color:#cc6f6f;font-weight:800}
.controls{display:flex;gap:8px;align-items:center}
button.full{width:100%}
.choice .letter{display:inline-block;width:28px;height:28px;border-radius:6px;background:linear-gradient(90deg,var(--bronze),#b77a1a);color:#081010;font-weight:900;text-align:center;line-height:28px;margin-right:10px}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>üìú √äXODO ‚Äî Quiz (Velho Testamento)</h1>
    <div class="meta">50 perguntas ‚Ä¢ se errar volta √† 1¬™ ‚Ä¢ tempo continua</div>
  </div>

  <div class="layout">
    <!-- LEFT -->
    <div class="panel card">
      <!-- START -->
      <section id="screen-start" class="qscreen active" aria-hidden="false">
        <div style="display:flex;gap:12px;align-items:center">
          <div class="logo">VT<br><span style="font-size:11px;color:var(--gold)">√äXODO</span></div>
          <div>
            <div style="font-weight:800;font-size:16px">Quiz ‚Äî √äxodo</div>
            <div class="tiny" style="margin-top:6px">Digite seu nome e toque em <strong>Come√ßar</strong>. O cron√¥metro inicia ao tocar e N√ÉO zera se errar.</div>
          </div>
        </div>

        <div style="margin-top:14px">
          <label class="tiny">Seu nome</label>
          <input id="playerName" type="text" placeholder="Ex: Jo√£o" />
          <div style="margin-top:12px;display:flex;gap:8px">
            <button id="btnStart" class="btn primary full">Come√ßar</button>
            <button id="btnResetAll" class="btn ghost">Resetar Tudo</button>
          </div>
        </div>
      </section>

      <!-- QUESTIONS wrapper -->
      <div id="questionsWrapper"></div>

      <!-- FAIL -->
      <section id="screen-fail" class="qscreen" aria-hidden="true">
        <div style="text-align:center">
          <div style="font-size:22px;font-weight:900;color:#b2313b">MISERIC√ìRDIA</div>
          <div id="failText" style="margin-top:12px;font-weight:800;font-size:16px"></div>
          <div style="margin-top:14px;display:flex;gap:8px;justify-content:center">
            <button id="btnRestartFromFail" class="btn primary">Recome√ßar (volta √† 1¬™)</button>
            <button id="btnResetFromFail" class="btn ghost">Resetar Tudo</button>
          </div>
          <div class="tiny" style="margin-top:10px">O tempo N√ÉO √© zerado ‚Äî ele continua contando enquanto voc√™ tenta de novo.</div>
        </div>
      </section>

      <!-- FINAL -->
      <section id="screen-final" class="qscreen" aria-hidden="true">
        <div style="text-align:center">
          <div style="font-size:22px;font-weight:900;color:var(--gold)">üéâ PARAB√âNS!</div>
          <div id="finalText" style="margin-top:12px;font-weight:800;font-size:16px"></div>
          <div style="margin-top:12px" class="tiny">Tempo: <span id="finalTime" style="font-weight:900;color:var(--gold)"></span></div>
          <div style="margin-top:12px;display:flex;gap:8px;justify-content:center">
            <button id="btnSave" class="btn primary">Salvar no ranking</button>
            <button id="btnPlayAgain" class="btn ghost">Jogar de novo (mesmo nome)</button>
          </div>
        </div>
      </section>
    </div>

    <!-- RIGHT -->
    <aside class="panel card" style="display:flex;flex-direction:column;gap:12px">
      <div class="stat">
        <div>
          <div class="tiny">Jogador</div>
          <div id="labelPlayer" style="font-weight:800">‚Äî</div>
        </div>
        <div style="text-align:right">
          <div class="tiny">N√≠vel</div>
          <div style="font-weight:800;color:var(--gold)">Velho Testamento</div>
        </div>
      </div>

      <div class="stat">
        <div>
          <div class="tiny">Cron√¥metro</div>
          <div id="timerLarge" style="font-weight:900;font-size:18px">00:00.000</div>
        </div>
        <div style="text-align:right">
          <div class="tiny">Progresso</div>
          <div id="progressSmall" style="font-weight:800">0 / 50</div>
        </div>
      </div>

      <div class="stat" style="flex-direction:column;align-items:flex-start">
        <div class="tiny" style="margin-bottom:8px">Ranking local (melhores tempos)</div>
        <div class="leader" id="leaderboard"></div>
        <div style="width:100%;display:flex;gap:8px;margin-top:8px">
          <button id="btnClear" class="btn ghost" style="flex:1">Limpar ranking</button>
          <button onclick="location.href='velho.html'" class="btn ghost" style="flex:1">Voltar</button>
        </div>
      </div>

      <div class="tiny">Dica: √∫ltimas 20 perguntas s√£o mais dif√≠ceis; √∫ltimas 5 quase imposs√≠veis.</div>
    </aside>
  </div>
</div>

<div id="floatingFail" class="failure-banner"></div>

<script>
/* ================= QUESTIONS (50) ‚Äî √äXODO =================
   - First 30: medium
   - 31-45: harder
   - 46-50: "IMPOSS√çVEIS" (answer = option that says "N√£o √© especificado" or similar)
*/
const QUESTIONS = [
 {id:1,type:'üìñ',q:'Quem liderou a sa√≠da do povo de Israel do Egito?',choices:['Mois√©s','Josu√©','Ar√£o','Calebe'],answer:0},
 {id:2,type:'üìñ',q:'Qual era o nome do irm√£o de Mois√©s que falava por ele?',choices:['Ar√£o','Nadabe','Abi√∫','Hur'],answer:0},
 {id:3,type:'üìñ',q:'Onde Mois√©s encontrou a sar√ßa ardente?',choices:['Monte Horebe','Monte Sinai','Monte Carmelo','Jerusal√©m'],answer:0},
 {id:4,type:'üìñ',q:'Quantas pragas Deus enviou ao Egito?',choices:['7','10','12','5'],answer:1},
 {id:5,type:'üìñ',q:'Qual foi a primeira praga?',choices:['√Ågua em sangue','R√£s','Gafanhotos','Trevas'],answer:0},
 {id:6,type:'üìñ',q:'O que o povo recebeu do c√©u no deserto?',choices:['Man√°','Mel','Carne de aves','√Ågua'],answer:0},
 {id:7,type:'üìñ',q:'Como Deus guiava os israelitas durante o dia?',choices:['Coluna de nuvem','Coluna de fogo','Estrelas','Trombetas'],answer:0},
 {id:8,type:'üìñ',q:'E √† noite?',choices:['Coluna de fogo','Coluna de nuvem','Lua','Anjos'],answer:0},
 {id:9,type:'üìñ',q:'Que sinal marcou a p√°scoa antes da sa√≠da do Egito?',choices:['Sangue nas portas','Tocha no telhado','Cordeiro morto','P√£o sem fermento'],answer:0},
 {id:10,type:'üìñ',q:'Quem era o fara√≥ que resistiu aos pedidos de liberta√ß√£o (nome popular)?',choices:['Rams√©s','Tutankamon','Neferefr√©','Men√©s'],answer:0},
 {id:11,type:'üìñ',q:'Qual foi o milagre que abriu passagem para os israelitas?',choices:['Mar Vermelho se abriu','Terra partiu','Torre caiu','Montanha dividida'],answer:0},
 {id:12,type:'üìñ',q:'Quem tocou no cajado e o transformou em serpente diante do fara√≥?',choices:['Mois√©s','Ar√£o','Josu√©','Calebe'],answer:0},
 {id:13,type:'üìñ',q:'Quem foi o porta-voz que ajudou Mois√©s perante o povo?',choices:['Ar√£o','Hur','Nadabe','Abi√∫'],answer:0},
 {id:14,type:'üìñ',q:'Onde o povo acampou antes de receber a lei?',choices:['Monte Sinai','Vale do Jord√£o','Betel','Esmirna'],answer:0},
 {id:15,type:'üìñ',q:'Quem construiu o bezerro de ouro?',choices:['Ar√£o','Mois√©s','Os anci√£os','Josu√©'],answer:0},
 {id:16,type:'üìñ',q:'Quantos anos os israelitas vagaram no deserto (tradi√ß√£o b√≠blica)?',choices:['20','40','70','50'],answer:1},
 {id:17,type:'üìñ',q:'Que objeto carregava as t√°buas da lei?',choices:['Arca do Testemunho','Tabern√°culo','C√°lice','Altar'],answer:0},
 {id:18,type:'üìñ',q:'Quem foi o l√≠der que sucedeu Mois√©s?',choices:['Josu√©','Ar√£o','Calebe','Elias'],answer:0},
 {id:19,type:'üìñ',q:'Qual era o papel do Tabern√°culo?',choices:['Lugar de encontros com Deus','Pal√°cio do rei','Biblioteca','Marinha'],answer:0},
 {id:20,type:'üìñ',q:'O que era o man√° frequentemente comparado?',choices:['Sementes','P√£o do c√©u','Dinheiro','Pedra'],answer:1},
 {id:21,type:'üìñ',q:'Quem defendeu Mois√©s quando sua autoridade foi questionada?',choices:['Jetro','Ar√£o','Hur','Josu√©'],answer:2},
 {id:22,type:'üìñ',q:'Quem foi punido por trazer fogo estranho ao altar?',choices:['Nadabe e Abi√∫','Cor√° e seus homens','Ar√£o e seus filhos','Miri√£ e Ar√£o'],answer:0},
 {id:23,type:'üìñ',q:'Onde foram guardadas as t√°buas ap√≥s serem quebradas?',choices:['Arca do Testemunho','Enterradas','Queimadas','Perdidas'],answer:0},
 {id:24,type:'üìñ',q:'Quem subiu ao monte para receber a lei inicialmente?',choices:['Mois√©s','Ar√£o','Josu√©','Calebe'],answer:0},
 {id:25,type:'üìñ',q:'Qual era a cerim√¥nia que marcava a santidade do Tabern√°culo?',choices:['Consagra√ß√£o dos sacerdotes','Casamento','Sacrif√≠cio de guerra','Festival do vinho'],answer:0},
 {id:26,type:'üìñ',q:'Qual elemento representava a presen√ßa de Deus sobre o tabern√°culo?',choices:['Nuvem e fogo','√Ågua','Terra','Vento'],answer:0},
 {id:27,type:'üìñ',q:'Quem era a irm√£ de Mois√©s que cantou ap√≥s a travessia?',choices:['Miri√£','D√©bora','Rute','Ester'],answer:0},
 {id:28,type:'üìñ',q:'Qual era o nome do lugar onde faltou √°gua e Mois√©s feriu a rocha?',choices:['Merib√°','Ribla','Betel','Gibe√°'],answer:0},
 {id:29,type:'üìñ',q:'Quem foi escolhido para liderar os ataques contra Amaleque?',choices:['Josu√©','Mois√©s','Calebe','Ar√£o'],answer:0},
 {id:30,type:'üìñ',q:'O que as pragas demonstraram sobre os deuses do Egito?',choices:['Que eram impotentes','Que eram verdadeiros','Que se multiplicavam','Que eram agrad√°veis'],answer:0},

 // 31-45 dif√≠ceis
 {id:31,type:'üîÆ',q:'Qual foi o significado da serpente de bronze (N√∫meros/√äxodo contexto)?',choices:['Cura e s√≠mbolo de f√©','Magia','Puni√ß√£o','Agricultura'],answer:0},
 {id:32,type:'üîÆ',q:'Quem era Jetro (Reuel) na hist√≥ria de Mois√©s?',choices:['Sogro de Mois√©s','General do Egito','Sacerdote do Fara√≥','Irm√£o de Ar√£o'],answer:0},
 {id:33,type:'üîÆ',q:'O que Mois√©s quebrou ao descer do monte?',choices:['T√°buas da Lei','A Arca','O Tabern√°culo','O Altar'],answer:0},
 {id:34,type:'üîÆ',q:'Qual era a fun√ß√£o dos levitas inicialmente?',choices:['Servir no Tabern√°culo','Serem reis','Serem profetas','Trabalhadores agr√≠colas'],answer:0},
 {id:35,type:'üîÆ',q:'Que oferta era feita no Yom Kippur (Dia da Expia√ß√£o)?',choices:['Sacrif√≠cio anual especial','Oferta de vinho','Oferta de incenso','Oferta de p√£o'],answer:0},
 {id:36,type:'üîÆ',q:'Como eram identificados os sacerdotes legitimamente?',choices:['Descend√™ncia de Ar√£o','Escolha popular','Elei√ß√£o por voto','Conquista militar'],answer:0},
 {id:37,type:'üîÆ',q:'Quem sucedeu Nadabe e Abi√∫ ap√≥s seu pecado?',choices:['Seus irm√£os ou filhos designados','Mois√©s','Ar√£o','Ningu√©m'],answer:0},
 {id:38,type:'üîÆ',q:'Qual era o prop√≥sito das festas (p.ex. P√°scoa) para Israel?',choices:['Lembran√ßa da liberta√ß√£o','Celebrar colheita','Casamentos','Rituais de guerra'],answer:0},
 {id:39,type:'üîÆ',q:'O que simbolizava a nuvem sobre o Tabern√°culo?',choices:['Presen√ßa de Deus','Sombra natural','Armadura','Sombria maldi√ß√£o'],answer:0},
 {id:40,type:'üîÆ',q:'Qual foi a rea√ß√£o do fara√≥ depois da d√©cima praga?',choices:['Deixou o povo partir','Prendeu mais o povo','Escondeu o ouro','Mudou de religi√£o'],answer:0},
 {id:41,type:'üîÆ',q:'Quem foram os montes associados a revela√ß√£o e mediacÃßaÃÉo?',choices:['Horebe/Sinai','Carmelo e Si√£o','Tabor e Hermom','Galaad e Ebal'],answer:0},
 {id:42,type:'üîÆ',q:'Que papel tinha o √©fode entre os sacerdotes?',choices:['Instrumento ritual e de consulta','Arma','Instrumento agr√≠cola','Vestimenta comum'],answer:0},
 {id:43,type:'üîÆ',q:'Quem foi Cor√° na narrativa do √™xodo?',choices:['L√≠der de uma rebeli√£o contra Mois√©s','Sacerdote leal','General do ex√©rcito','Profeta estrangeiro'],answer:0},
 {id:44,type:'üîÆ',q:'Qual era a import√¢ncia da consagra√ß√£o dos sacerdotes?',choices:['Permitir o servi√ßo sagrado','Dar poder pol√≠tico','Autorizar casamentos','Permitir com√©rcio'],answer:0},
 {id:45,type:'üîÆ',q:'Qual era a consequ√™ncia do toque indevido do santu√°rio?',choices:['Morte ou puni√ß√£o severa','Promo√ß√£o','B√™n√ß√£o','Imunidade'],answer:0},

 // 46-50 imposs√≠veis (respostas que apontam "N√£o √© especificado")
 {id:46,type:'üîÆ',q:'IMPOSS√çVEL: Qual era a cor exata das t√°buas originais?',choices:['Dourado','Marfim','N√£o √© especificado','Vermelho'],answer:2,impossible:true},
 {id:47,type:'üîÆ',q:'IMPOSS√çVEL: Quantos sacrif√≠cios exatamente foram feitos no per√≠odo inteiro do Tabern√°culo?',choices:['1234','5678','N√£o √© especificado','9999'],answer:2,impossible:true},
 {id:48,type:'üîÆ',q:'IMPOSS√çVEL: Qual era a melodia que Miri√£ cantou ap√≥s o mar?',choices:['Can√ß√£o de Mois√©s','Hino perdido','N√£o √© especificado','C√¢ntico do sol'],answer:2,impossible:true},
 {id:49,type:'üîÆ',q:'IMPOSS√çVEL: Quantos passos cada israelita deu durante a travessia do mar?',choices:['123','1','N√£o √© especificado','0'],answer:2,impossible:true},
 {id:50,type:'üîÆ',q:'IMPOSS√çVEL: Qual era o perfume exato usado no incenso do Tabern√°culo?',choices:['Nardo','Mirra','N√£o √© especificado','Incenso arom√°tico'],answer:2,impossible:true}
];

/* ================= STATE ================= */
let player = '';
let index = 0; // question index 0-based
let started = false;
let startTimestamp = null;
let timerInterval = null;

/* ================= DOM ================= */
const startScreen = document.getElementById('screen-start');
const questionsWrapper = document.getElementById('questionsWrapper');
const failScreen = document.getElementById('screen-fail');
const finalScreen = document.getElementById('screen-final');
const btnStart = document.getElementById('btnStart');
const btnResetAll = document.getElementById('btnResetAll');
const btnRestartFromFail = document.getElementById('btnRestartFromFail');
const btnResetFromFail = document.getElementById('btnResetFromFail');
const btnSave = document.getElementById('btnSave');
const btnPlayAgain = document.getElementById('btnPlayAgain');
const failText = document.getElementById('failText');
const finalText = document.getElementById('finalText');
const finalTime = document.getElementById('finalTime');
const labelPlayer = document.getElementById('labelPlayer');
const timerLarge = document.getElementById('timerLarge');
const progressSmall = document.getElementById('progressSmall');
const leaderboardEl = document.getElementById('leaderboard');
const btnClear = document.getElementById('btnClear');
const floatingFail = document.getElementById('floatingFail');

const TOTAL = QUESTIONS.length;

/* ================= MESSAGES (7) ================= */
const FAIL_MESSAGES = [
  'MISERIC√ìRDIA, {name}!',
  'O Fara√≥ venceu dessa vez, {name}!',
  'Deus te dar√° outra chance, {name}!',
  'As √°guas se fecharam, {name} üò≠',
  'Volta pro come√ßo, {name} ‚Äî aprende a√≠!',
  '{name}, errou feio üòÖ',
  'Tenta de novo, servo fiel: {name}!'
];

/* ================ HELPERS ================ */
function fmtTime(ms){
  const s = Math.floor(ms/1000);
  const mm = Math.floor(s/60).toString().padStart(2,'0');
  const ss = (s % 60).toString().padStart(2,'0');
  const msRem = (ms % 1000).toString().padStart(3,'0');
  return `${mm}:${ss}.${msRem}`;
}
function showFloating(text){
  floatingFail.textContent = text;
  floatingFail.style.display = 'block';
  setTimeout(()=> floatingFail.style.opacity = '1',10);
  setTimeout(()=> { floatingFail.style.opacity = '0'; setTimeout(()=> floatingFail.style.display='none',300); },1600);
}

/* ================ TIMER ================ */
function startTimerIfNeeded(){
  if(startTimestamp === null) startTimestamp = performance.now();
  if(timerInterval) clearInterval(timerInterval);
  timerInterval = setInterval(()=> {
    const elapsed = Math.floor(performance.now() - startTimestamp);
    timerLarge.textContent = fmtTime(elapsed);
    progressSmall.textContent = `${index}/${TOTAL}`;
  }, 80);
}
function stopTimer(){
  if(timerInterval){ clearInterval(timerInterval); timerInterval = null; }
}
function getElapsed(){
  if(!startTimestamp) return 0;
  return Math.floor(performance.now() - startTimestamp);
}

/* ================ BUILD QUESTIONS UI ================ */
function buildQuestionScreens(){
  questionsWrapper.innerHTML = '';
  QUESTIONS.forEach((q, idx) => {
    const sec = document.createElement('section');
    sec.className = 'qscreen panel';
    sec.id = 'q-'+idx;
    const meta = document.createElement('div'); meta.className='q-meta';
    meta.innerHTML = `<div class="tiny">${q.type || 'üîπ'} ${q.impossible?'<span class="impossible">‚Ä¢ IMPOSS√çVEL</span>':''}</div><div class="tiny">Pergunta ${idx+1} / ${TOTAL}</div>`;
    const qText = document.createElement('div'); qText.className='q-text'; qText.textContent = q.q;
    const choices = document.createElement('div'); choices.className='choices';
    q.choices.forEach((c, ci)=>{
      const b = document.createElement('button');
      b.className = 'choice';
      b.innerHTML = `<span class="letter">${String.fromCharCode(65+ci)}</span> <span style="vertical-align:middle">${c}</span>`;
      b.addEventListener('click', ()=> handleAnswer(idx, ci));
      choices.appendChild(b);
    });
    sec.appendChild(meta); sec.appendChild(qText); sec.appendChild(choices);
    questionsWrapper.appendChild(sec);
  });
}

/* ================ LEADERBOARD ================ */
function renderLeaderboard(){
  const key = 'exodo_quiz_rank';
  let arr = [];
  try{ arr = JSON.parse(localStorage.getItem(key) || '[]'); }catch(e){ arr = []; }
  arr.sort((a,b)=> a.timeMs - b.timeMs);
  leaderboardEl.innerHTML = '';
  if(arr.length === 0){ leaderboardEl.innerHTML = '<div class="tiny">Nenhum campe√£o ainda ‚Äî seja o primeiro!</div>'; return; }
  arr.slice(0,10).forEach((r,i)=>{
    const row = document.createElement('div');
    row.style.display='flex'; row.style.justifyContent='space-between'; row.style.padding='6px 0'; row.style.borderBottom='1px dashed rgba(255,255,255,0.03)';
    row.innerHTML = `<div style="font-weight:800">#${i+1} ${escapeHtml(r.name)}</div><div class="tiny">${fmtTime(r.timeMs)}</div>`;
    leaderboardEl.appendChild(row);
  });
}

/* ================ FLOW ================ */
btnStart.addEventListener('click', ()=>{
  const nameVal = (document.getElementById('playerName').value || '').trim();
  if(!nameVal){ const ip = document.getElementById('playerName'); ip.style.border='1px solid #f66'; ip.focus(); setTimeout(()=> ip.style.border='',800); return; }
  player = nameVal;
  labelPlayer.textContent = player;
  index = 0;
  started = true;
  buildQuestionScreens();
  startTimerIfNeeded();
  showScreenByIndex(0);
  renderLeaderboard();
});

btnResetAll.addEventListener('click', ()=>{
  if(!confirm('Resetar tudo: zera tempo, progresso e nome?')) return;
  player = '';
  index = 0;
  started = false;
  startTimestamp = null;
  stopTimer();
  timerLarge.textContent = '00:00.000';
  progressSmall.textContent = `0 / ${TOTAL}`;
  document.getElementById('playerName').value = '';
  labelPlayer.textContent = '‚Äî';
  showScreen(startScreen);
});

btnRestartFromFail.addEventListener('click', ()=>{
  index = 0;
  showScreenByIndex(0);
});

btnResetFromFail.addEventListener('click', ()=>{
  if(!confirm('Resetar tudo: zera tempo, progresso e nome?')) return;
  player = '';
  index = 0;
  started = false;
  startTimestamp = null;
  stopTimer();
  timerLarge.textContent = '00:00.000';
  progressSmall.textContent = `0 / ${TOTAL}`;
  document.getElementById('playerName').value = '';
  labelPlayer.textContent = '‚Äî';
  showScreen(startScreen);
});

btnPlayAgain.addEventListener('click', ()=>{
  index = 0;
  startTimestamp = performance.now();
  startTimerIfNeeded();
  showScreenByIndex(0);
});

btnSave.addEventListener('click', ()=>{
  const elapsed = getElapsed();
  const key = 'exodo_quiz_rank';
  let arr = [];
  try{ arr = JSON.parse(localStorage.getItem(key) || '[]'); }catch(e){ arr=[]; }
  arr.push({ name: player || '‚Äî', timeMs: elapsed, date: new Date().toISOString() });
  if(arr.length>200) arr = arr.slice(arr.length-200);
  localStorage.setItem(key, JSON.stringify(arr));
  renderLeaderboard();
  alert('Salvo no ranking local!');
});

btnClear.addEventListener('click', ()=>{
  if(confirm('Limpar ranking local?')){ localStorage.removeItem('exodo_quiz_rank'); renderLeaderboard(); }
});

/* ================ ANSWER HANDLING ================ */
function handleAnswer(qIdx, choiceIdx){
  if(!started) return;
  const q = QUESTIONS[qIdx];
  const correct = (choiceIdx === q.answer);
  if(correct){
    const next = qIdx + 1;
    index = next;
    if(next >= TOTAL){
      const elapsed = getElapsed();
      finalText.textContent = `PARAB√âNS ${player.toUpperCase()} ‚Äî Voc√™ concluiu!`;
      finalTime.textContent = fmtTime(elapsed);
      showScreen(finalScreen);
    } else {
      showScreenByIndex(next);
    }
  } else {
    // wrong: show fail screen, set index to 0 but DO NOT stop timer
    const tpl = FAIL_MESSAGES[Math.floor(Math.random()*FAIL_MESSAGES.length)];
    const msg = tpl.replace('{name}', player || 'amigo');
    failText.textContent = msg;
    showScreen(failScreen);
    index = 0;
    showFloating(msg);
  }
}

/* ================ UI HELPERS ================ */
function showScreen(el){
  document.querySelectorAll('.qscreen').forEach(s=>{ s.classList.remove('active'); s.setAttribute('aria-hidden','true'); });
  el.classList.add('active'); el.setAttribute('aria-hidden','false');
}
function showScreenByIndex(i){
  const sec = document.getElementById('q-'+i);
  if(!sec) return;
  showScreen(sec);
  progressSmall.textContent = `${i}/${TOTAL}`;
}
function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

/* ================ INIT ================ */
(function init(){
  buildQuestionScreens();
  renderLeaderboard();
  timerLarge.textContent = '00:00.000';
  progressSmall.textContent = `0 / ${TOTAL}`;
})();
</script>
</body>
</html>

