<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ESTUDO B√çBLICO ‚Äì Apocalipse Quiz</title>
<style>
  :root{
    --bg1:#06123a; --bg2:#0b3a8a; --gold:#d4af37; --card:#fff;
    --muted:#9fb0d8;
  }
  *{box-sizing:border-box;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;}
  body{margin:0;min-height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,var(--bg1),#08306a);color:#072047;padding:20px}
  .app{width:100%;max-width:980px;background:linear-gradient(180deg,rgba(255,255,255,0.95),#fbfdff);border-radius:14px;overflow:hidden;box-shadow:0 20px 60px rgba(2,6,23,0.6)}
  header{display:flex;align-items:center;justify-content:space-between;padding:14px 20px;border-bottom:1px solid rgba(5,20,40,0.04)}
  header h1{margin:0;font-size:18px;display:flex;gap:10px;align-items:center}
  header .meta{color:var(--muted);font-size:13px}
  main{display:flex;gap:18px;padding:20px}
  .left{flex:1}
  .right{width:320px}
  .card{background:linear-gradient(180deg,#fff,#fbfdff);padding:16px;border-radius:10px;border:1px solid rgba(10,20,40,0.04);box-shadow:0 8px 24px rgba(6,14,60,0.04)}
  .logo{width:72px;height:72px;border-radius:12px;background:linear-gradient(135deg,var(--bg2),#0b2a7a);display:flex;align-items:center;justify-content:center;color:white;font-weight:800}
  input[type=text]{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(10,20,40,0.06)}
  .btn{padding:10px 14px;border-radius:10px;border:none;background:linear-gradient(90deg,var(--bg2),#123a94);color:white;font-weight:700;cursor:pointer}
  .btn.ghost{background:transparent;border:1px solid rgba(8,30,80,0.06);color:var(--bg2)}
  .qscreen{display:none;animation:fadein 260ms ease both}
  .active{display:block}
  @keyframes fadein{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}
  .q-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;color:var(--muted);font-size:13px}
  .q-text{font-size:18px;font-weight:700;color:#072047;margin-bottom:12px}
  .choices{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .choice{background:white;padding:12px;border-radius:10px;border:1px solid rgba(10,20,40,0.04);cursor:pointer;transition:transform 120ms ease,box-shadow 120ms}
  .choice:hover{transform:translateY(-4px);box-shadow:0 12px 30px rgba(8,24,64,0.06)}
  .right .stat{margin-bottom:10px}
  .leader{max-height:260px;overflow:auto}
  .msg{position:fixed;left:50%;top:18px;transform:translateX(-50%);padding:10px 14px;border-radius:10px;color:white;font-weight:800;z-index:9999;display:none}
  .fail{background:linear-gradient(90deg,#7b1530,#b22a4a)}
  .succ{background:linear-gradient(90deg,#0a6b2d,#23a24a)}
  .small{font-size:13px;color:var(--muted)}
  .footer{padding:12px 20px;text-align:center;color:var(--muted);font-size:13px;border-top:1px solid rgba(10,20,40,0.03)}
  .gold{color:var(--gold);font-weight:800}
  .controls{display:flex;gap:8px}
  .impossible{color:#8b2d2d;font-weight:800}
</style>
</head>
<body>
<div class="msg" id="floatingMsg"></div>

<div class="app" role="application" aria-label="Quiz Apocalipse">
  <header>
    <h1>üìò ESTUDO B√çBLICO ‚Äì PERGUNTAS <span style="font-size:12px;color:var(--muted);margin-left:8px">(Apocalipse ‚Ä¢ Vis√£o Adventista)</span></h1>
    <div class="meta">50 perguntas ‚Ä¢ se errar ‚Üí volta para a 1¬™ ‚Ä¢ tempo continua</div>
  </header>

  <main>
    <div class="left">
      <!-- Tela 1: Explica√ß√£o / Start -->
      <section id="screen-intro" class="card qscreen active" aria-hidden="false">
        <div style="display:flex;gap:14px">
          <div class="logo">APOC<br><span style="font-size:11px;opacity:0.9">QUIZ</span></div>
          <div style="flex:1">
            <div style="font-weight:800;font-size:16px">ESTUDO B√çBLICO ‚Äì PERGUNTAS</div>
            <div class="small" style="margin-top:8px">Regras: Responda 50 perguntas sobre o Apocalipse. As √∫ltimas 20 s√£o mais dif√≠ceis; as √∫ltimas 5 s√£o praticamente imposs√≠veis. Se errar, MISERIC√ìRDIA ‚Äî voc√™ volta para a primeira pergunta, mas o tempo continua contando. Boa sorte!</div>
          </div>
        </div>

        <div style="margin-top:14px">
          <label class="small">Digite seu nome</label>
          <input id="nameInput" type="text" placeholder="Ex: Jo√£o" />
          <div style="margin-top:12px;display:flex;gap:8px;align-items:center">
            <button id="btnStart" class="btn">Iniciar</button>
            <button id="btnResetAll" class="btn ghost">Resetar Tudo</button>
            <div style="margin-left:auto;text-align:right">
              <div class="small">Tempo: <span id="timeDisplay">00:00.000</span></div>
              <div class="small">Progresso: <span id="progDisplay">0/50</span></div>
            </div>
          </div>
        </div>
      </section>

      <!-- Perguntas: uma tela por pergunta ser√° gerada dinamicamente -->
      <div id="questionsContainer"></div>

      <!-- Tela Erro -->
      <section id="screen-fail" class="card qscreen" aria-hidden="true">
        <div style="text-align:center">
          <div style="font-size:22px;font-weight:900;color:#7b1530">MISERIC√ìRDIA</div>
          <div id="failMsg" style="margin-top:12px;font-weight:700;font-size:16px"></div>

          <div style="margin-top:18px">
            <button id="btnRestartFromFail" class="btn">Recome√ßar (volta √† 1¬™ pergunta)</button>
            <button id="btnResetFromFail" class="btn ghost" style="margin-left:8px">Resetar Tudo</button>
          </div>

          <div style="margin-top:12px" class="small">O tempo n√£o foi zerado ‚Äî continua contando enquanto voc√™ tenta de novo.</div>
        </div>
      </section>

      <!-- Tela Final -->
      <section id="screen-final" class="card qscreen" aria-hidden="true">
        <div style="text-align:center">
          <div style="font-size:22px;font-weight:900;color:var(--gold)">üéâ PARAB√âNS!</div>
          <div id="finalMsg" style="margin-top:12px;font-weight:700;font-size:16px"></div>
          <div style="margin-top:12px" class="small">Seu tempo: <span id="finalTime" class="gold"></span></div>

          <div style="margin-top:18px">
            <button id="btnSaveScore" class="btn">Salvar no ranking</button>
            <button id="btnPlayAgain" class="btn ghost" style="margin-left:8px">Jogar de novo (nome mantido)</button>
          </div>
        </div>
      </section>
    </div>

    <aside class="right">
      <div class="card stat">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div class="small">Jogador</div>
            <div id="playerLabel" style="font-weight:800">‚Äî</div>
          </div>
          <div>
            <div class="small">N√≠vel</div>
            <div class="gold">M√©dio ‚Üí Dif√≠cil</div>
          </div>
        </div>
      </div>

      <div class="card stat">
        <div class="small">Cron√¥metro</div>
        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px">
          <div style="font-weight:900;font-size:18px" id="timerLarge">00:00.000</div>
          <div class="small">Progresso<br><strong id="progSmall">0/50</strong></div>
        </div>
      </div>

      <div class="card stat">
        <div class="small">Ranking local (melhores tempos)</div>
        <div class="leader" id="leaderboard" style="margin-top:8px"></div>
        <div style="margin-top:8px;display:flex;gap:8px">
          <button id="btnClearRanking" class="btn ghost">Limpar ranking</button>
        </div>
      </div>

      <div class="card stat small">
        Dica: leia com calma. As √∫ltimas perguntas s√£o propositalmente muito dif√≠ceis.
      </div>

    </aside>
  </main>

  <div class="footer">Feito pra voc√™ ‚Äî salve <code>apocalipse_quiz.html</code> e compartilhe com os amigos.</div>
</div>

<script>
/* ===== CONFIG ===== */
const QUESTIONS = [
  // 50 perguntas (mesmas que combinamos)
  {id:1,type:'üìñ',q:'Qual √© o primeiro selo mencionado em Apocalipse 6?',choices:['Cavalo branco','Cavalo vermelho','Cavalo preto','Cavalo amarelo'],answer:0},
  {id:2,type:'üìñ',q:'Quantos anjos tocam trombetas em Apocalipse?',choices:['5','7','4','12'],answer:1},
  {id:3,type:'üìñ',q:'Quem √© lan√ßado no lago de fogo em Apocalipse 20?',choices:['Os justos','O Diabo','O profeta','O anjo da trombeta'],answer:1},
  {id:4,type:'üìñ',q:'O que representa o n√∫mero 144.000 em Apocalipse (vis√£o adventista)?',choices:['Profetas','Fam√≠lias','Servos de Deus selados','Ap√≥stolos'],answer:2},
  {id:5,type:'üìñ',q:'Onde Jo√£o recebeu as vis√µes do Apocalipse?',choices:['Na Galileia','Na Patmos','Em Jerusal√©m','No Templo'],answer:1},
  {id:6,type:'üìñ',q:'Quantas ta√ßas da ira de Deus s√£o derramadas?',choices:['4','7','3','10'],answer:1},
  {id:7,type:'üìñ',q:'Qual √© a cor do cavalo que simboliza fome (Ap 6)?',choices:['Branco','Preto','Amarelo (p√°lido)','Vermelho'],answer:2},
  {id:8,type:'üìñ',q:'Quem venceu o drag√£o e seus anjos (Apocalipse)?',choices:['Miguel','Jesus','Jo√£o','O profeta'],answer:0},
  {id:9,type:'üìñ',q:'Quem s√£o os 24 anci√£os vistos no trono (interpreta√ß√£o comum)?',choices:['Profetas','Ap√≥stolos e representantes do povo de Deus','Anjos apenas','Reis da terra'],answer:1},
  {id:10,type:'üìñ',q:'O que Jo√£o v√™ no cap√≠tulo 1 do Apocalipse?',choices:['O Cristo glorioso','Profetas','O drag√£o','Os selos'],answer:0},
  {id:11,type:'üìñ',q:'Qual livro cont√©m as cartas √†s sete igrejas?',choices:['Mateus','Apocalipse','Daniel','Atos'],answer:1},
  {id:12,type:'üìñ',q:'Quem s√£o os que derramam as ta√ßas da ira de Deus?',choices:['Anjos','Profetas','Ap√≥stolos','Humanos'],answer:0},
  {id:13,type:'üìñ',q:'A besta em Apocalipse √© frequentemente entendida como?',choices:['Um sistema politico-religioso opressor','Um anjo','Um membro da igreja','Um animal literal'],answer:0},
  {id:14,type:'üìñ',q:'Qual n√∫mero √© comumente chamado de n√∫mero da besta?',choices:['616','666','777','999'],answer:1},
  {id:15,type:'üìñ',q:'O que simboliza a Nova Jerusal√©m?',choices:['Uma cidade literal em outro planeta','Comunh√£o final de Deus com o Seu povo','A capital de um imp√©rio humano','Um s√≠mbolo de poder'],answer:1},
  {id:16,type:'üîÆ',q:'A mulher vestida de sol √© interpretada por muitos como?',choices:['A Igreja fiel','Israel e o remanescente','Uma √∫nica profetisa','A cidade de Roma'],answer:1},
  {id:17,type:'üîÆ',q:'O drag√£o na vis√£o costuma representar:',choices:['Satan√°s/Diabo','Um imp√©rio econ√¥mico','Um anjo ca√≠do','Uma estrela cadente'],answer:0},
  {id:18,type:'üîÆ',q:'As trombetas anunciam principalmente:',choices:['Festividades','Julgamentos progressivos','Harvests','Vit√≥rias militares'],answer:1},
  {id:19,type:'üîÆ',q:'O livro com sete selos nas m√£os de Cristo simboliza:',choices:['O julgamento e plano de Deus','Um cat√°logo','Um tratado humano','Um calend√°rio'],answer:0},
  {id:20,type:'üîÆ',q:'Babil√¥nia simboliza mais comumente:',choices:['Sistema corrupto de poder e religi√£o','Uma cidade literal espec√≠fica','Uma estrela','Uma can√ß√£o'],answer:0},
  {id:21,type:'üîÆ',q:'Armagedom simboliza:',choices:['Local literal','Concentra√ß√£o do conflito entre bem e mal','Uma constru√ß√£o','Uma festa'],answer:1},
  {id:22,type:'üîÆ',q:'Os m√°rtires sob o altar indicam:',choices:['Que morreram em v√£o','Que Deus lembrar√° e vindicar√°','Que o altar era literal','Que a hist√≥ria acabou'],answer:1},
  {id:23,type:'üîÆ',q:'O arco-√≠ris sobre o trono simboliza:',choices:['Promessa e miseric√≥rdia de Deus','Medo','Fen√¥meno meteorol√≥gico','Contrato humano'],answer:0},
  {id:24,type:'üîÆ',q:'Besta do mar e besta da terra sugerem:',choices:['Poderes pol√≠ticos e religiosos opressores','Animais reais','Eventos naturais','Rios'],answer:0},
  {id:25,type:'üîÆ',q:'A lua ficando como sangue representa:',choices:['Sinais simb√≥licos do ju√≠zo','Mudan√ßa clim√°tica','Fim dos colheitas','Um eclipse comum'],answer:0},
  {id:26,type:'üîÆ',q:'O selo de Deus na testa significa:',choices:['Prote√ß√£o e identifica√ß√£o do remanescente','Marca f√≠sica de servid√£o','Cura','Puni√ß√£o'],answer:0},
  {id:27,type:'üîÆ',q:'A queda de estrelas pode representar:',choices:['Anjos ca√≠dos','Meteoros','Planetas','Filhos de Israel'],answer:0},
  {id:28,type:'üîÆ',q:'A vindica√ß√£o dos santos enfatiza:',choices:['Justi√ßa futura e restaura√ß√£o','Vingan√ßa humana','Triunfo pol√≠tico','Restaura√ß√£o de templos'],answer:0},
  {id:29,type:'üîÆ',q:'Babil√¥nia √© lembrada por:',choices:['Seu esp√≠rito corrupto e queda','Sua neutralidade','Sua b√™n√ß√£o','Sua riqueza'],answer:0},
  {id:30,type:'üîÆ',q:'O mar de vidro misturado com fogo representa:',choices:['Pureza e julgamento','Um lago literal','Um oceano moderno','Uma met√°fora econ√¥mica'],answer:0},
  {id:31,type:'üîÆ',q:'No contexto adventista, o tempo do fim enfatiza:',choices:['Reavivamento e miss√£o','Apenas pol√≠tica','Somente arqueologia','Acumular riquezas'],answer:0},
  {id:32,type:'üîÆ',q:'O falso profeta age principalmente por:',choices:['Religi√£o enganadora e sinais','Armas f√≠sicas','Fen√¥menos naturais','Tecnologia somente'],answer:0},
  {id:33,type:'üîÆ',q:'O conflito culmina em:',choices:['Restaura√ß√£o do car√°ter de Deus e ju√≠zo do mal','Tr√©gua eterna','Destrui√ß√£o do c√©u','Novo imp√©rio humano'],answer:0},
  {id:34,type:'üîÆ',q:'O selo dos 144.000 aponta para:',choices:['Lealdade a Deus e testemunho fiel','Riqueza','Poder militar','Rituais secretos'],answer:0},
  {id:35,type:'üîÆ',q:'A mensagem do terceiro anjo (Ap 14) adverte contra:',choices:['Adorar a besta e receber sua marca','Doa√ß√µes','Jejum','Constru√ß√£o de templos'],answer:0},
  {id:36,type:'üîÆ',q:'O grande trono branco anuncia:',choices:['Que toda obra ser√° julgada','Perd√£o autom√°tico','Fim imediato do sofrimento','Um novo rei humano'],answer:0},
  {id:37,type:'üîÆ',q:'\"J√° n√£o haver√° noite\" aponta para:',choices:['Plena comunh√£o com Deus e fim do sofrimento','Apag√£o global','Sono coletivo','Evento meteorol√≥gico'],answer:0},
  {id:38,type:'üîÆ',q:'As trevas no ju√≠zo comunicam:',choices:['Sombreamento do poder sat√¢nico sobre a consci√™ncia','Falha el√©trica','Sono','Fim do sol'],answer:0},
  {id:39,type:'üîÆ',q:'A restaura√ß√£o final inclui:',choices:['Nova ordem moral e remo√ß√£o do mal','Repeti√ß√£o dos erros','Substitui√ß√£o por outro mal','Apenas mitos'],answer:0},
  {id:40,type:'üîÆ',q:'A adora√ß√£o verdadeira no fim √©:',choices:['Lealdade a Deus, s√°bado e amor ao pr√≥ximo','Rituais vazios','Apoio a imp√©rios','Crescimento econ√¥mico'],answer:0},
  {id:41,type:'üîÆ',q:'O papel do livro selado na cronologia do ju√≠zo √©:',choices:['Registra e revela as decis√µes de Deus','D√° ordens aos anjos','√â ilustrativo','Calend√°rio humano'],answer:0},
  {id:42,type:'üîÆ',q:'\"N√£o se colocou no c√©u\" (referido a Babil√¥nia) significa:',choices:['Sua autoridade n√£o era divina e ser√° julgada','Que esteve no c√©u fisicamente','Que √© imortal','Que governa anjos'],answer:0},
  {id:43,type:'üîÆ',q:'As cores dos cavalos representam:',choices:['Aspectos do ju√≠zo e condi√ß√µes humanas','Sindicatos','Na√ß√µes espec√≠ficas','Atributos meteorol√≥gicos'],answer:0},
  {id:44,type:'üîÆ',q:'\"Tempo, tempos e metade\" √© interpretado como:',choices:['Per√≠odo prof√©tico simb√≥lico de prova','3.5 dias reais','Um m√™s lunar','Uma era geol√≥gica'],answer:0},
  {id:45,type:'üîÆ',q:'O principal objetivo das profecias apocal√≠pticas √©:',choices:['Revelar o car√°ter de Deus e o resultado final da hist√≥ria','Prever datas exatas','Enriquecer l√≠deres','Criar mitos'],answer:0},
  {id:46,type:'üîÆ',q:'IMPOSS√çVEL: Conte quantas plumas exatas havia no cavalo da vis√£o ‚Äî escolha a op√ß√£o simb√≥lica correta.',choices:['3','7','nenhuma ‚Äî s√≠mbolo n√£o especifica','12'],answer:2,impossible:true},
  {id:47,type:'üîÆ',q:'IMPOSS√çVEL: Qual era o perfume exato usado no trono visto por Jo√£o?',choices:['Nardo','Mirra','N√£o √© especificado','Incenso arom√°tico'],answer:2,impossible:true},
  {id:48,type:'üîÆ',q:'IMPOSS√çVEL: Quantas letras exatas comp√µem o nome da besta no idioma original da vis√£o?',choices:['3','6','Nunca √© mostrado em detalhe','9'],answer:2,impossible:true},
  {id:49,type:'üîÆ',q:'IMPOSS√çVEL: Qual era a cor exata do selo que ningu√©m leu?',choices:['Dourada','Prateada','N√£o √© especificado','Vermelha'],answer:2,impossible:true},
  {id:50,type:'üîÆ',q:'IMPOSS√çVEL: Quantos pensamentos exatos o anjo teve ao abrir o selo ‚Äî escolha a resposta simb√≥lica.',choices:['Um','Sete','N√£o mensur√°vel','Tr√™s'],answer:2,impossible:true}
];

const FAIL_MESSAGES = [
  'MISERIC√ìRDIA, {name}!',
  'Ai n√£o... {name}, tenta de novo!',
  'O c√©u fechou pra voc√™, {name} üò≠',
  'Ah n√£o ‚Äî miseric√≥rdia, {name}!',
  'Volta pro come√ßo, {name} ‚Äî aprende a√≠!',
  '{name}, errou feio üòÖ',
  'Tenta de novo, servo fiel: {name}!'
];

/* ===== STATE ===== */
let playerName = '';
let currentIndex = 0; // 0-based
let started = false;
let startTime = null; // performance.now() when started
let timerId = null;

/* ===== UI REFS ===== */
const screenIntro = document.getElementById('screen-intro');
const questionsContainer = document.getElementById('questionsContainer');
const screenFail = document.getElementById('screen-fail');
const screenFinal = document.getElementById('screen-final');
const nameInput = document.getElementById('nameInput');
const btnStart = document.getElementById('btnStart');
const btnResetAll = document.getElementById('btnResetAll');
const btnRestartFromFail = document.getElementById('btnRestartFromFail');
const btnResetFromFail = document.getElementById('btnResetFromFail');
const btnPlayAgain = document.getElementById('btnPlayAgain');
const btnSaveScore = document.getElementById('btnSaveScore');
const failMsg = document.getElementById('failMsg');
const finalMsg = document.getElementById('finalMsg');
const finalTimeEl = document.getElementById('finalTime');
const playerLabel = document.getElementById('playerLabel');
const timerLarge = document.getElementById('timerLarge');
const timeDisplay = document.getElementById('timeDisplay');
const progDisplay = document.getElementById('progDisplay');
const progSmall = document.getElementById('progSmall');
const leaderboard = document.getElementById('leaderboard');
const btnClearRanking = document.getElementById('btnClearRanking');
const floatingMsg = document.getElementById('floatingMsg');

const TOTAL = QUESTIONS.length;

/* ===== HELPERS ===== */
function showScreen(el){
  // hide all qscreens
  document.querySelectorAll('.qscreen').forEach(s => { s.classList.remove('active'); s.setAttribute('aria-hidden','true'); });
  el.classList.add('active'); el.setAttribute('aria-hidden','false');
}
function fmt(ms){
  const s = Math.floor(ms/1000);
  const mm = Math.floor(s/60).toString().padStart(2,'0');
  const ss = (s%60).toString().padStart(2,'0');
  const msRem = (ms%1000).toString().padStart(3,'0');
  return `${mm}:${ss}.${msRem}`;
}
function nowMs(){ return Math.floor(performance.now()); }
function startTimerIfNeeded(){
  if(startTime===null) startTime = performance.now();
  if(timerId) clearInterval(timerId);
  timerId = setInterval(()=> {
    const elapsed = Math.floor(performance.now() - startTime);
    timerLarge.textContent = fmt(elapsed);
    timeDisplay.textContent = fmt(elapsed);
  }, 80);
}
function stopTimer(){
  if(timerId){ clearInterval(timerId); timerId = null; }
}
function showFloating(text, kind='fail'){
  floatingMsg.textContent = text;
  floatingMsg.className = 'msg ' + (kind==='fail'?'fail':'succ');
  floatingMsg.style.display = 'block';
  setTimeout(()=> { floatingMsg.style.opacity = '1'; }, 10);
  setTimeout(()=> {
    floatingMsg.style.opacity = '0';
    setTimeout(()=> floatingMsg.style.display='none',300);
  },1600);
}
function saveToRanking(name, timeMs){
  const key='apoc_quiz_rank';
  let arr=[];
  try{ arr = JSON.parse(localStorage.getItem(key) || '[]'); }catch(e){ arr=[]; }
  arr.push({name, timeMs, date:new Date().toISOString()});
  arr = arr.slice(-200);
  localStorage.setItem(key, JSON.stringify(arr));
}

/* ===== RENDER LEADERBOARD ===== */
function renderLeaderboard(){
  const key='apoc_quiz_rank';
  let arr=[];
  try{ arr = JSON.parse(localStorage.getItem(key) || '[]'); }catch(e){ arr=[]; }
  arr.sort((a,b)=> a.timeMs - b.timeMs);
  leaderboard.innerHTML = '';
  if(arr.length===0){ leaderboard.innerHTML = '<div class="small">Nenhum campe√£o ainda ‚Äî seja o primeiro!</div>'; return; }
  arr.slice(0,10).forEach((r,i) => {
    const row = document.createElement('div');
    row.style.display='flex';row.style.justifyContent='space-between';row.style.padding='6px 0';row.style.borderBottom='1px dashed rgba(0,0,0,0.04)';
    row.innerHTML = `<div style="font-weight:800">#${i+1} ${escapeHtml(r.name)}</div><div class="small">${fmt(r.timeMs)}</div>`;
    leaderboard.appendChild(row);
  });
}

/* ===== BUILD QUESTION SCREENS (one per question) ===== */
function buildQuestionsUI(){
  questionsContainer.innerHTML = ''; // clear
  QUESTIONS.forEach((q, idx) => {
    const sec = document.createElement('section');
    sec.className='card qscreen'; sec.id = 'q-'+idx;
    // header
    const header = document.createElement('div'); header.className='q-header';
    header.innerHTML = `<div class="small">${q.type} ${q.impossible?'<span class="impossible">‚Ä¢ IMPOSS√çVEL</span>':''}</div><div class="small">Pergunta ${idx+1} / ${TOTAL}</div>`;
    // text
    const qtext = document.createElement('div'); qtext.className='q-text'; qtext.textContent = q.q;
    // choices
    const choices = document.createElement('div'); choices.className='choices';
    q.choices.forEach((c,ci) => {
      const b = document.createElement('button'); b.className='choice'; b.innerHTML = `<div style="font-weight:700">${String.fromCharCode(65+ci)}.</div><div style="margin-top:6px">${c}</div>`;
      b.addEventListener('click', ()=> onAnswer(idx, ci));
      choices.appendChild(b);
    });
    // assemble
    sec.appendChild(header); sec.appendChild(qtext); sec.appendChild(choices);
    questionsContainer.appendChild(sec);
  });
}

/* ===== ANSWER HANDLING ===== */
function onAnswer(qIdx, choiceIdx){
  if(!started) return;
  const q = QUESTIONS[qIdx];
  if(choiceIdx === q.answer){
    // correto -> anima√ß√£o r√°pida e ir pra pr√≥xima pergunta (ou final)
    const nextIdx = qIdx + 1;
    if(nextIdx >= TOTAL){
      // finalizou
      const elapsed = Math.floor(performance.now() - startTime);
      stopTimer();
      finalMsg.textContent = `PARAB√âNS ${playerName.toUpperCase()} ‚Äî Voc√™ completou!`;
      finalTimeEl.textContent = fmt(elapsed);
      showScreen(screenFinal);
      // keep startTime (so if they save it's the final time)
    } else {
      // ir pra pr√≥xima tela
      currentIndex = nextIdx;
      updateProgressUI();
      showScreen(document.getElementById('q-'+nextIdx));
    }
  } else {
    // errado -> reset para pergunta 1 (index 0), mostrar tela de erro com mensagem aleat√≥ria e bot√£o recome√ßar
    const tpl = FAIL_MESSAGES[Math.floor(Math.random()*FAIL_MESSAGES.length)];
    const msg = tpl.replace('{name}', playerName || 'amigo');
    failMsg.textContent = msg;
    // go to fail screen
    showScreen(screenFail);
    // currentIndex resets to 0, but time continues (do not clear startTime)
    currentIndex = 0;
    updateProgressUI(); // show 0/50 etc
    // do not stop timer
    showFloating(msg, 'fail');
  }
}

/* ===== UI / Controls ===== */
function updateProgressUI(){
  progDisplay.textContent = `${currentIndex}/${TOTAL}`;
  progSmall.textContent = `${currentIndex}/${TOTAL}`;
}

btnStart.addEventListener('click', ()=>{
  const name = (nameInput.value || '').trim();
  if(!name){ nameInput.style.border='1px solid #f66'; setTimeout(()=> nameInput.style.border='',800); nameInput.focus(); return; }
  playerName = name;
  playerLabel.textContent = playerName;
  // init
  started = true;
  startTimerIfNeeded(); // start timer (if not already)
  currentIndex = 0;
  updateProgressUI();
  buildQuestionsUI(); // ensure screens exist
  showScreen(document.getElementById('q-0'));
  // scroll focus
  setTimeout(()=> { const firstBtn = document.querySelector('#q-0 .choice'); if(firstBtn) firstBtn.focus(); }, 80);
});

btnResetAll.addEventListener('click', ()=>{
  if(!confirm('Resetar tudo: zera tempo, progresso e nome?')) return;
  // reset full
  playerName = '';
  nameInput.value = '';
  nameInput.disabled = false;
  playerLabel.textContent = '‚Äî';
  currentIndex = 0;
  started = false;
  startTime = null;
  stopTimer();
  timerLarge.textContent = '00:00.000';
  timeDisplay.textContent = '00:00.000';
  progDisplay.textContent = `0/${TOTAL}`;
  progSmall.textContent = `0/${TOTAL}`;
  showScreen(screenIntro);
});

btnRestartFromFail.addEventListener('click', ()=>{
  // volta para 1¬™ pergunta (index 0). Tempo N√ÉO zera.
  currentIndex = 0;
  updateProgressUI();
  showScreen(document.getElementById('q-0'));
});

btnResetFromFail.addEventListener('click', ()=> {
  if(!confirm('Resetar tudo: zera tempo, progresso e nome?')) return;
  playerName=''; nameInput.value=''; playerLabel.textContent='‚Äî'; currentIndex=0; started=false; startTime=null; stopTimer();
  timerLarge.textContent='00:00.000'; timeDisplay.textContent='00:00.000'; progDisplay.textContent=`0/${TOTAL}`; progSmall.textContent=`0/${TOTAL}`;
  showScreen(screenIntro);
});

btnPlayAgain.addEventListener('click', ()=>{
  // jogar de novo mantendo o nome, tempo continua? No pedido anterior, se quiser reiniciar tempo precisa Resetar Tudo.
  // We'll let them play again: keep name, reset progress, but keep timer (startTime cleared so new run restarts timer)
  currentIndex = 0;
  // restart time for fresh run
  startTime = performance.now();
  startTimerIfNeeded();
  showScreen(document.getElementById('q-0'));
});

btnSaveScore.addEventListener('click', ()=>{
  const elapsed = Math.floor(performance.now() - startTime);
  saveToRanking(playerName || '‚Äî', elapsed);
  renderLeaderboard();
  alert('Salvo no ranking local!');
});

btnClearRanking.addEventListener('click', ()=>{
  if(confirm('Limpar ranking local (no seu navegador)?')){ localStorage.removeItem('apoc_quiz_rank'); renderLeaderboard(); }
});

/* ===== INIT ===== */
(function init(){
  buildQuestionsUI();
  renderLeaderboard();
  updateProgressUI();
  showScreen(screenIntro);
})();

/* ===== UTILS ===== */
function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

</script>
</body>
</html>
